#!/usr/bin/env python
# coding: utf-8

from smb2.header import Direction
from smb2.close import Close

close_req_buf_1 = bytes([
    0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
])

close_rep_buf_1 = bytes([
    0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00
])


def pr(buf):
    for i in buf:
        print("%02x " % i, end='')
    print()

def main():
    print('Decode and re-encode a Close Request #1')
    c = Close()
    cmd = c.decode(Direction.REQUEST, close_req_buf_1)
    buf = c.encode(Direction.REQUEST, cmd)

    if close_req_buf_1 != buf:
        print('Re-encoded content mismatch')
        print('Original:')
        pr(close_req_buf_1)
        print('Encoded:')
        pr(buf)
        exit(1)

    print('Decode and re-encode a Close Reply #1')
    c = Close()
    cmd = c.decode(Direction.REPLY, close_rep_buf_1)
    buf = c.encode(Direction.REPLY, cmd)

    if close_rep_buf_1 != buf:
        print('Re-encoded content mismatch')
        print('Original:')
        pr(close_rep_buf_1)
        print('Encoded:')
        pr(buf)
        exit(1)


if __name__ == "__main__":
    main()
